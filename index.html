<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can LLMs Draw with SGP? - SphereLab</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 页面特定样式 */
        :root {
            --primary-color-dark: #8a8a8a;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #fff;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .article-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header-nav {
            display: flex;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #eaeaea;
            margin-bottom: 40px;
        }
        
        .home-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: color 0.2s;
        }
        
        .home-link:hover {
            color: var(--primary-color);
        }
        
        .home-link svg {
            width: 32px;
            height: 18px;
            margin-right: 8px;
        }
        
        .article-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .date-tag {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .date {
            font-size: 14px;
            color: var(--secondary-text-color);
        }
        
        .tag {
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .article-title {
            font-size: 40px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        .article-abstract {
            font-size: 16px;
            color: var(--secondary-text-color);
            max-width: 600px;
            margin: 0 auto 30px;
            text-align: left;
            background-color: #e9f4f8;
            padding: 20px;
            border-radius: 10px;
            font-style: italic;
        }
        
        .project-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 40px;
        }
        
        .project-link {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .project-link i {
            margin-right: 8px;
        }
        
        .project-link.github {
            background-color: #24292e;
            color: white;
        }
        
        .project-link.github:hover {
            background-color: #1a1e22;
        }
        
        .project-link.huggingface {
            background-color: #ee9a1b;
            color: white;
        }
        
        .project-link.huggingface:hover {
            background-color: #ce8f32;
        }
        
        .project-link.arxiv {
            background-color: #b31b1b;
            color: white;
        }
        
        .project-link.arxiv:hover {
            background-color: #9c1717;
        }
        
        .article-content {
            font-size: 17px;
            line-height: 1.7;
        }
        
        .article-content p {
            margin-bottom: 24px;
        }
        
        .article-section {
            margin: 60px 0;
        }
        
        .article-content h2 {
            font-size: 28px;
            font-weight: 700;
            margin: 40px 0 24px;
            scroll-margin-top: 80px;
        }
        
        .note {
            font-style: italic;
            color: var(--secondary-text-color);
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .feature-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
            scroll-margin-top: 80px;
        }
        
        .feature-button {
            background-color: var(--light-gray);
            border: none;
            border-radius: 20px;
            padding: 10px 18px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        
        .feature-button:hover {
            background-color: #e5e5e5;
        }
        
        .feature-button.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .reasoning-process {
            margin: 30px 0;
            border: 1px solid #eaeaea;
            border-radius: 8px;
            padding: 20px;
            background-color: #f9f9f9;
        }
        
        .reasoning-container {
            min-height: 200px;
        }
        
        .reasoning-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Navigation links for sections */
        .section-nav {
            position: fixed;
            left: calc(50vw - 600px); /* 靠近内容区，540=800/2+140，内容最大宽800px，nav宽约140px */
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .section-link {
            font-size: 14px;
            font-weight: 500;
            color: var(--secondary-text-color);
            text-decoration: none;
            transition: color 0.2s;
            padding: 5px 10px;
            white-space: nowrap;
        }
        
        .section-link:hover, 
        .section-link.active {
            color: var(--primary-color);
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }
        
        /* Subsection navigation styling */
        .section-link[href^="#visual-search"],
        .section-link[href^="#visual-puzzle"],
        .section-link[href^="#geography"],
        .section-link[href^="#medical"],
        .section-link[href^="#science"],
        .section-link[href^="#information"],
        .section-link[href^="#more"] {
            font-size: 12px;
            padding-left: 20px;
            color: #888;
        }
        
        /* 作者栏左右分栏布局 */
        .authors-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 40px;
            background: #f3f3f3;
            border-radius: 10px;
            padding: 24px 24px 24px 24px;
            margin: 20px 0 40px;
            border-bottom: 1px solid #eaeaea;
        }
        .authors-meta {
            flex: 1.3;
        }
        .authors-title, .affiliations-title, .published-title {
            color: #a0a0a0;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 1px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .authors-list {
            display: block;
            font-size: 16px;
            font-weight: 400;
            color: #111;
            /* margin-bottom: 10px; */
        }
        .author {
            font-size: 16px;
            font-weight: 400;
        }
        .author sup {
            font-size: 12px;
            color: #a4a4a4;
            font-weight: 600;
        }
        .author-note {
            font-size: 13px;
            color: #888;
            margin-top: 8px;
            font-style: normal;
            text-align: left;
        }
        .authors-right {
            flex: 1;
            min-width: 180px;
            text-align: left;
        }
        .affiliations-list {
            font-size: 16px;
            color: #111;
        }
        .published-date {
            font-size: 16px;
            color: #111;
        }
        @media (max-width: 768px) {
            .authors-section {
                flex-direction: column;
                gap: 10px;
                text-align: left;
            }
            .authors-right {
                text-align: left;
                min-width: 0;
            }
        }
        
        /* 页脚样式 */
        footer {
            padding: 20px 0;
            margin-top: 60px;
            text-align: center;
        }
        
        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .footer-social {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .social-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: #666;
            transition: color 0.2s, transform 0.2s;
            font-size: 18px;
            background-color: #f5f5f5;
        }
        
        .social-icon:hover {
            color: var(--primary-color);
            transform: translateY(-3px);
            background-color: #eeeeee;
        }
        
        .copyright {
            font-size: 14px;
            color: #666;
        }

        /* code style */
        .bibtex-block {
            background: #f7f7fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 18px 18px 12px 18px;
            margin: 32px 0 32px 0;
            position: relative;
        }
        .bibtex-title {
            font-size: 16px;
            font-weight: 600;
            color: #444;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        .bibtex-pre {
            font-size: 14px;
            color: #333;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
            white-space: pre;
            line-height: 1.6;
            overflow-x: auto;
            word-break: normal;
        }
        .bibtex-copy-btn {
            position: absolute;
            top: 18px;
            right: 18px;
            background: #ededed;
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            font-size: 13px;
            color: #666;
            cursor: pointer;
            transition: background 0.2s;
        }
        .bibtex-copy-btn:hover {
            background: #e0e0e0;
            color: #222;
        }
        
        @media (max-width: 768px) {
            .article-title {
                font-size: 32px;
            }
            
            .feature-buttons {
                justify-content: center;
            }
            
            .authors-list {
                flex-direction: column;
                gap: 10px;
            }

            body {
                padding: 0 15px;
            }

            .container {
                padding: 0;
            }

            .article-container {
                padding: 0;
            }
        }

        @media (max-width: 1200px) {
            .section-nav {
                position: static;
                transform: none;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                margin: 30px 0;
                padding: 15px 0;
                border-top: 1px solid #eaeaea;
                border-bottom: 1px solid #eaeaea;
                background: none;
                box-shadow: none;
                left: 0;
            }
            .article-container {
                padding-left: 0;
            }
        }
        
        /* Reasoning process styling */
        .reasoning-container {
            max-height: 600px;
            overflow-y: auto;
            padding: 16px;
            width: 100%;
        }
        
        .reasoning-error {
            padding: 20px;
            text-align: center;
            color: #d32f2f;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .error-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .reasoning-message {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .reasoning-user {
            background-color: #f1f5f9;
        }
        
        .reasoning-user strong {
            display: block;
            margin-bottom: 10px;
            color: #1d75a5;
            font-size: 1.1em;
        }
        
        .reasoning-assistant {
            background-color: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .reasoning-text {
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .reasoning-code {
            margin: 12px 0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .reasoning-code pre {
            margin: 0;
            padding: 12px;
            background-color: #2b2b2b;
            color: #f8f8f2;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .reasoning-interpreter-output {
            margin: 12px 0;
            padding: 12px;
            background-color: #f7f7f9;
            border-left: 4px solid #8a8a8a;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .reasoning-image-wrap {
            margin: 12px 0;
            text-align: center;
        }
        
        .reasoning-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .reasoning-image.enlarged {
            max-height: none;
            max-width: 90%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10;
            position: relative;
        }
        
        .reasoning-answer {
            margin-top: 16px;
        }
        
        .answer-box {
            padding: 12px 16px;
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 6px;
            color: #388e3c;
            font-weight: 600;
        }
        
        .user-question {
            background-color: #e8f5fe;
            border-left: 4px solid #1d75a5;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .user-question strong {
            display: block;
            color: #1d75a5;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        /* 对话气泡样式 */
        .bubble {
            max-width: 80%;
            padding: 14px 18px;
            border-radius: 18px;
            font-size: 16px;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            word-break: break-word;
        }
        .bubble-gpt {
            background: #ffffff;
            color: #222;
            align-self: flex-start;
            border-top-left-radius: 6px;
            margin-right: auto;
        }
        .bubble-human {
            background: #f3f9ff;
            color: #1a3a5d;
            align-self: flex-end;
            border-top-right-radius: 6px;
            margin-left: auto;
        }
        .reasoning-message {
            display: flex;
            margin-bottom: 16px;
        }
        
        /* 新增：标识符样式 */
        .tag-indicator {
            font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
            font-size: 12px;
            color: #666;
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            margin: 2px 0;
            border: 1px solid #e0e0e0;
            display: inline-block;
        }
        
        .reasoning-code-block,
        .reasoning-image-block,
        .reasoning-interpreter-block,
        .reasoning-answer-block {
            margin: 12px 0;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            padding: 8px;
            background-color: #fafafa;
        }
        
        /* Category sections styling */
        .category-section {
            margin: 50px 0;
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 40px;
        }
        
        .category-section:last-child {
            border-bottom: none;
        }
        
        .category-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color-dark);
        }
        
        .category-buttons {
            margin-bottom: 30px;
        }
    </style>
</head>
<body>

    <main class="article-container">
        <article>
            <div class="article-header" style="margin-top: 30px;">
                <div class="date-tag">
                    <span class="date">September 9, 2025</span>
                    <span class="tag">Released</span>
                </div>
                <h1 class="article-title">Symbolic Graphics Programming with Large Language Models</h1>
                <div style="text-align: center;margin-bottom: 30px;">
                    <img src="img/sgp-teaser.svg" alt="SVG tesaer"">
                </div>

                <!-- authors -->
                <div class="authors-section">
                    <div class="authors-meta">
                        <div class="authors-title" style="text-align:left;">AUTHORS</div>
                        <div class="authors-list" style="text-align:left;">
                            <span class="author">Yamei Chen<sup>1,2,*</sup></span>, 
                            <span class="author">Haoquan Zhang<sup>1,3,*</sup></span>, 
                            <span class="author">Yangyi Huang<sup>1,2</sup></span>, 
                            <span class="author">Zeju Qiu<sup>4</sup></span>, 
                            <span class="author">Kaipeng Zhang<sup>3</sup></span>, 
                            <span class="author">Yandong Wen<sup>2</sup></span>, 
                            <span class="author">Weiyang Liu<sup>1,4</sup></span>
                        </div>
                        <div class="author-note">* Equal Contributing</div>
                    </div>
                    <div class="authors-right">
                        <div class="affiliations-title">AFFILIATIONS</div>
                        <div class="affiliations-list">
                            <sup>1</sup> CUHK<br>
                            <sup>2</sup> Westlake University<br>
                            <sup>3</sup> Shanghai AI Laboratory<br>
                            <sup>4</sup> MPI-IS
                        </div>
                    </div>
                </div>

                <div class="project-links">
                    <a href="https://github.com/Sphere-AI-Lab/SGP-RL" class="project-link github">
                        <i class="fab fa-github"></i> Code
                    </a>
                    <a href="https://huggingface.co/datasets/SphereLab/sgp-gen-model" class="project-link huggingface">
                        <i class="fas fa-rocket"></i> Model
                    </a>
                    <a href="https://huggingface.co/collections/SphereLab/sgp-generation-68b7d8a3b70ff81184c9923d" class="project-link huggingface">
                        <i class="fas fa-chart-bar"></i> Bench
                    </a>
                    <a href="TBA" class="project-link arxiv">
                        <i class="fas fa-file-alt"></i> Paper
                    </a>
                </div>
                
            </div>
            
            <nav class="section-nav">
                <a href="#introduction" class="section-link active">Introduction</a>
                <a href="#sgp-gen-bench" class="section-link">SGP-Gen-Bench</a>
                <a href="#method" class="section-link">Method</a>
                <a href="#results" class="section-link">Results</a>
                <a href="#object-scene" class="section-link" style="font-size: 12px; padding-left: 20px; color: #888;">Object & Scene</a>
                <a href="#composition" class="section-link" style="font-size: 12px; padding-left: 20px; color: #888;">Composition</a>
                <a href="#analysis" class="section-link">Analysis</a>
                <a href="#bibtex" class="section-link">Bibtex</a>
            </nav>

            <div class="article-content">
                <h2 id="introduction">Introduction</h2>
                <p>
                Large language models (LLMs) excel at understanding and generating code, but their ability to create symbolic graphics programs (SGPs)—which produce images remains underexplored. SVGs, as a widely used SGP format, provide an ideal testbed for evaluating LLMs in this area. We address two main research questions:
                </p>
                <p>
                <span style="color:#1274c5; font-weight:bold;">(1) how well can LLMs draw using SGPs?</span> 
                <br>
                <span style="color:#1274c5;">To address the first question, we introduce <em>SGP-GenBench</em>, a comprehensive benchmark for evaluating LLMs' ability to generate SGPs from three perspectives: object, scene, and composition.</span>
                </p>
                <p>
                <span style="color:#970d0d; font-weight:bold;">(2) how can we improve their ability to generate SGPs?</span>
                <br>
                <span style="color:#970d0d;">To improve performance, we propose a reinforcement learning approach that uses similarity scores between visual encoder outputs and input text descriptions as reward signals. Our experiments show that RL significantly boosts the symbolic graphics programming abilities of LLMs.</span>
                </p>
                <p>
                </p>

                <h2 id="sgp-gen-bench">SGP as Visual Synthesis</h2>
                <img src="img/parameterized- procedural.drawio.svg" alt="SVG visual synthesis"">
                <p>
                    Symbolic graphics programming (SGP) aims to generate structured graphics code, such as SVG, from natural language instructions. Unlike conventional text-to-image models that produce pixel-based images, SGP translates prompts into interpretable, parametric programs, enabling precise and controllable visual synthesis.
                </p>
                <p>
                    SVG is widely used and serves as a natural bridge between language and vision, making it ideal for evaluating LLMs' ability to ground semantics from prompt to code.
                    SGPs are both:
                </p>
                <p>
                    <b style="color:#1274c5;">(a) PARAMETRIC</b>
                    <span style="color:#1274c5;"> - allowing exact geometric and appearance control</span>
                    <br>
                    <b style="color:#1ca67a;">(b) PROCEDURAL</b>
                    <span style="color:#1ca67a;"> - supporting hierarchical and compositional scene construction.</span>
                </p>
                <p>
                    These properties enable fine-grained, interpretable, and flexible visual generation, and allow us to directly analyze the complexity and structure of generated scenes.
                </p>

                <h2 id="sgp-gen-bench">SGP-GenBench</h2>
                <h3> Construction </h3>
                <p>
                    <ul>
                        <li><b>- Scene generation</b>: Evaluated on COCO-val, covering 80 object categories with complex scene descriptions. We sample 1,024 images for efficient and representative assessment.</li>
                        <li><b>- Object generation</b>: Assessed on SGP-Object-val, a set of 930 single-object examples with captions, focusing on the model's ability to render individual objects accurately.</li>
                        <li><b>- Compositional generation</b>: Tested on SGP-CompBench with 3,200 prompts, targeting attribute binding, spatial relationships, and numeracy using 80 common objects for compositional evaluation.</li>
                    </ul>
                </p>

                <h2 id="method">Method</h2>
                <img src="img/method.drawio.svg" alt="Method" style="width:80%;max-width:1000px;display:block;margin:auto;">
                    <p>
                        Given a text description, we sample a group of SVG codes from the model and render them as images. Each SVG code is scored by the alignment between the rendered image and the text description. The advantages are calculated based on the scores, and used for updating the model.
                    </p>
                <h3>Discussion of Method</h3>
                <p></p>
                <p>
                    <b>Distilling from vision models.</b>
                    We use external vision models (e.g., DINO, CLIP) to define rewards, guiding the LLM to align its generations with strong visual and semantic priors. This implicit distillation improves both visual understanding and cross-modal alignment.
                </p>
                <p>
                    <b>Training without ground truth SGPs.</b>
                    Our RL method learns directly from images using feedback from vision models, removing the need for paired image-program data and enabling scalable, diverse training.
                </p>
                <p>
                    <b>Aligning language and vision.</b>
                    The RL process ensures that generated SGPs are consistent with both linguistic input and visual model judgments, grounding language in visual evidence and enhancing cross-modal reasoning.
                </p>
                
                <h2 id="results">Results</h2>
                <h3>Overview of SGP-GenBench</h3>
                <p></p>
                <!-- INSERT_YOUR_CODE -->
                <ul style="line-height:1.7em;margin-bottom:18px;">
                    <li>
                        <b>SGP-GenBench reflects general model abilities.</b>
                        The ranking of models on our benchmark aligns well with their perceived general capabilities, especially in code generation. For example, Claude 3.7 Sonnet Thinking generally outperforms o3, which in turn surpasses Gemini 2.5 Pro Preview, followed by open-source systems like DeepSeek-R1 and Qwen-2.5-7B. This consistent ordering suggests that SVG generation is a reliable indicator of broader model competence.
                    </li>
                    <li>
                        <b>Closed-source models remain strongest.</b>
                        Frontier systems achieve the best results not only on compositional reasoning tasks such as attribute binding and numeracy, where Claude 3.7 Sonnet Thinking reaches 90.5 on color binding and 89.4 on numeracy, but also on scene and object fidelity, where Gemini 2.5 Pro Preview attains the top DINO object score of 0.653 and strong VQA scene performance of 0.554.
                    </li>
                    <li>
                        <b>Our RL-trained model substantially narrows the gap.</b>
                        The RL post-trained Qwen-2.5-7B raises its overall compositional score from 8.8 to 60.8, outperforming all other open-source counterparts such as DeepSeek-R1 and QwQ-32B. It also achieves the best VQA score across all models at 0.596, slightly higher than Claude 3.7 Sonnet Thinking, demonstrating that reinforcement learning enables open-source models to approach the closed-source frontier.
                    </li>
                </ul>
                <h3 id="object-scene">Object & Scene</h3>
                <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
                <style>
                    #sortable-results-table {
                        font-size: 14px;
                        background: #fff;
                        border: 1px solid #ddd;
                        margin: 20px 0;
                        width: 100%;
                    }
                    #sortable-results-table th, #sortable-results-table td {
                        border: 1px solid #ddd;
                        padding: 6px 8px;
                        text-align: center;
                    }
                    #sortable-results-table th {
                        background: #f8f9fa;
                        font-weight: 600;
                        cursor: pointer;
                    }
                    #sortable-results-table .group-header {
                        background: #f0f0f0;
                        font-weight: 600;
                        text-align: left;
                    }
                    #sortable-results-table .ours-row {
                        background: rgba(255, 165, 0, 0.15);
                        font-weight: 600;
                    }
                </style>
                <table id="sortable-results-table" style="width:100%">
                    <thead>
                        <tr>
                            <th rowspan="2" data-orderable="false">Model</th>
                            <th colspan="3">CLIP&nbsp;&uarr;</th>
                            <th colspan="3">DINO&nbsp;&uarr;</th>
                            <th colspan="3">VQA&nbsp;&uarr;</th>
                            <th colspan="3">HPS&nbsp;&uarr;</th>
                        </tr>
                        <tr>
                            <th>Sce.</th>
                            <th>Obj.</th>
                            <th>Avg.</th>
                            <th>Sce.</th>
                            <th>Obj.</th>
                            <th>Avg.</th>
                            <th>Sce.</th>
                            <th>Obj.</th>
                            <th>Avg.</th>
                            <th>Sce.</th>
                            <th>Obj.</th>
                            <th>Avg.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="group-header"><td colspan="13">Frontier closed-source LLMs</td></tr>
                        <tr>
                            <td>GPT-4o-mini</td>
                            <td>0.207</td><td>0.278</td><td>0.243</td>
                            <td>0.021</td><td>0.573</td><td>0.297</td>
                            <td>0.295</td><td>0.465</td><td>0.380</td>
                            <td>0.118</td><td>0.174</td><td>0.146</td>
                        </tr>
                        <tr>
                            <td>GPT-4o</td>
                            <td>0.219</td><td>0.284</td><td>0.252</td>
                            <td>0.031</td><td>0.602</td><td>0.316</td>
                            <td>0.338</td><td>0.497</td><td>0.417</td>
                            <td>0.125</td><td>0.182</td><td>0.153</td>
                        </tr>
                        <tr>
                            <td>o1-mini</td>
                            <td>0.221</td><td>0.289</td><td>0.255</td>
                            <td>0.028</td><td>0.603</td><td>0.315</td>
                            <td>0.330</td><td>0.508</td><td>0.419</td>
                            <td>0.121</td><td>0.185</td><td>0.153</td>
                        </tr>
                        <tr>
                            <td>o1</td>
                            <td>0.220</td><td>0.285</td><td>0.252</td>
                            <td>0.031</td><td>0.607</td><td>0.319</td>
                            <td>0.354</td><td>0.520</td><td>0.437</td>
                            <td>0.122</td><td>0.185</td><td>0.153</td>
                        </tr>
                        <tr>
                            <td>o3-mini</td>
                            <td>0.231</td><td>0.293</td><td>0.262</td>
                            <td>0.036</td><td>0.608</td><td>0.322</td>
                            <td>0.379</td><td>0.520</td><td>0.450</td>
                            <td>0.128</td><td>0.187</td><td>0.158</td>
                        </tr>
                        <tr>
                            <td>o3</td>
                            <td>0.253</td><td>0.283</td><td>0.268</td>
                            <td>0.067</td><td>0.595</td><td>0.331</td>
                            <td>0.521</td><td>0.482</td><td>0.502</td>
                            <td>0.153</td><td>0.180</td><td>0.166</td>
                        </tr>
                        <tr>
                            <td>o4-mini</td>
                            <td>0.246</td><td>0.296</td><td>0.271</td>
                            <td>0.052</td><td>0.629</td><td>0.340</td>
                            <td>0.469</td><td>0.536</td><td>0.503</td>
                            <td>0.143</td><td>0.193</td><td>0.168</td>
                        </tr>
                        <tr>
                            <td>Gemini 2.0 Flash</td>
                            <td>0.204</td><td>0.275</td><td>0.240</td>
                            <td>0.023</td><td>0.588</td><td>0.306</td>
                            <td>0.293</td><td>0.468</td><td>0.381</td>
                            <td>0.116</td><td>0.176</td><td>0.146</td>
                        </tr>
                        <tr>
                            <td>Gemini 2.5 Flash Preview</td>
                            <td>0.222</td><td>0.286</td><td>0.254</td>
                            <td>0.033</td><td>0.603</td><td>0.318</td>
                            <td>0.349</td><td>0.498</td><td>0.424</td>
                            <td>0.125</td><td>0.183</td><td>0.154</td>
                        </tr>
                        <tr>
                            <td>Gemini 2.5 Pro Preview</td>
                            <td>0.256</td><td>0.302</td><td>0.279</td>
                            <td>0.088</td><td><b>0.653</b></td><td><b>0.371</b></td>
                            <td>0.554</td><td>0.572</td><td>0.563</td>
                            <td>0.154</td><td>0.199</td><td>0.177</td>
                        </tr>
                        <tr>
                            <td>Claude 3.5 Sonnet</td>
                            <td>0.240</td><td>0.293</td><td>0.266</td>
                            <td>0.055</td><td>0.624</td><td>0.340</td>
                            <td>0.428</td><td>0.528</td><td>0.478</td>
                            <td>0.140</td><td>0.190</td><td>0.165</td>
                        </tr>
                        <tr>
                            <td>Claude 3.7 Sonnet</td>
                            <td><b>0.262</b></td><td><b>0.306</b></td><td><b>0.284</b></td>
                            <td>0.088</td><td>0.647</td><td>0.368</td>
                            <td>0.581</td><td>0.567</td><td>0.574</td>
                            <td><b>0.165</b></td><td><b>0.200</b></td><td><b>0.183</b></td>
                        </tr>
                        <tr>
                            <td>Claude 3.7 Thinking</td>
                            <td><b>0.262</b></td><td>0.305</td><td><b>0.284</b></td>
                            <td><b>0.090</b></td><td>0.642</td><td>0.366</td>
                            <td><b>0.594</b></td><td><b>0.574</b></td><td><b>0.584</b></td>
                            <td>0.164</td><td>0.199</td><td>0.181</td>
                        </tr>
                        <tr class="group-header"><td colspan="13">Open-source LLMs</td></tr>
                        <tr>
                            <td>QwQ-32B</td>
                            <td>0.219</td><td>0.272</td><td>0.245</td>
                            <td>0.031</td><td>0.549</td><td>0.290</td>
                            <td>0.334</td><td>0.456</td><td>0.395</td>
                            <td>0.123</td><td>0.172</td><td>0.147</td>
                        </tr>
                        <tr>
                            <td>DeepSeek-R1</td>
                            <td>0.228</td><td>0.278</td><td>0.253</td>
                            <td>0.042</td><td><b>0.594</b></td><td>0.318</td>
                            <td>0.416</td><td>0.508</td><td>0.462</td>
                            <td>0.134</td><td><b>0.180</b></td><td>0.157</td>
                        </tr>
                        <tr>
                            <td>Qwen-2.5-7B</td>
                            <td>0.155</td><td>0.213</td><td>0.184</td>
                            <td>0.008</td><td>0.400</td><td>0.204</td>
                            <td>0.265</td><td>0.385</td><td>0.325</td>
                            <td>0.103</td><td>0.148</td><td>0.125</td>
                        </tr>
                        <tr class="ours-row">
                            <td>Qwen-2.5-7B w/ RL (ours)</td>
                            <td><b>0.258</b></td><td><b>0.286</b></td><td><b>0.272</b></td>
                            <td><b>0.102</b></td><td>0.566</td><td><b>0.334</b></td>
                            <td><b>0.632</b></td><td><b>0.560</b></td><td><b>0.596</b></td>
                            <td><b>0.150</b></td><td>0.177</td><td><b>0.164</b></td>
                        </tr>
                    </tbody>
                </table>
                <p style="font-size:13px;color:#666;margin-top:6px;">
                    <span>Click any column header to sort ascending/descending. Bold indicates the best in each group.</span>
                </p>
                <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
                <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
                <script>
                    // 使分组行不可排序，且点击表头可排序
                    $(document).ready(function() {
                        // 先移除分组行，单独保存
                        var groupRows = [];
                        $('#sortable-results-table .group-header').each(function(){
                            groupRows.push({
                                index: $(this).index(),
                                html: $(this)[0].outerHTML
                            });
                            $(this).remove();
                        });

                        // 初始化DataTable
                        var table = $('#sortable-results-table').DataTable({
                            paging: false,
                            searching: false,
                            info: false,
                            ordering: true,
                            order: [],
                            autoWidth: false,
                            // Model列不可排序
                            columnDefs: [
                                { orderable: false, targets: 0 }
                            ],
                            language: {
                                emptyTable: "无数据"
                            }
                        });

                        // 重新插入分组行
                        groupRows.forEach(function(gr, idx){
                            // 计算插入位置
                            var rowIdx = gr.index - idx;
                            var node = $(gr.html)[0];
                            table.row(rowIdx).node().parentNode.insertBefore(node, table.row(rowIdx).node());
                        });
                    });
                </script>
                
                <h3 id="composition">Composition</h3>
                <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
                <style>
                    #composition-results-table {
                        font-size: 14px;
                        background: #fff;
                        border: 1px solid #ddd;
                        margin: 20px 0;
                        width: 100%;
                    }
                    #composition-results-table th, #composition-results-table td {
                        border: 1px solid #ddd;
                        padding: 6px 8px;
                        text-align: center;
                    }
                    #composition-results-table th {
                        background: #f8f9fa;
                        font-weight: 600;
                        cursor: pointer;
                    }
                    #composition-results-table .group-header {
                        background: #f0f0f0;
                        font-weight: 600;
                        text-align: left;
                    }
                    #composition-results-table .ours-row {
                        background: rgba(255, 165, 0, 0.15);
                        font-weight: 600;
                    }
                </style>
                <table id="composition-results-table" style="width:100%">
                    <thead>
                        <tr>
                            <th rowspan="2" data-orderable="false">Model</th>
                            <th colspan="4">Attribute Binding&nbsp;&uarr;</th>
                            <th colspan="4">Spatial Relation&nbsp;&uarr;</th>
                            <th colspan="4">Numeracy&nbsp;&uarr;</th>
                            <th rowspan="2">Avg.&nbsp;&uarr;</th>
                        </tr>
                        <tr>
                            <th style="font-size:12px;">Color</th>
                            <th style="font-size:12px;">Shape</th>
                            <th style="font-size:12px;">Texture</th>
                            <th style="font-size:12px;">Avg.</th>
                            <th style="font-size:12px;">2D</th>
                            <th style="font-size:12px;">3D</th>
                            <th style="font-size:12px;">Implicit</th>
                            <th style="font-size:12px;">Avg.</th>
                            <th style="font-size:12px;">Total</th>
                            <th style="font-size:12px;">Item</th>
                            <th style="font-size:12px;">CPI</th>
                            <th style="font-size:12px;">Overall</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="group-header"><td colspan="14">Frontier closed-source LLMs</td></tr>
                        <tr>
                            <td>GPT-4o</td>
                            <td>62.2</td><td>48.7</td><td>34.3</td><td>48.4</td>
                            <td>49.7</td><td>37.3</td><td>49.2</td><td>45.4</td>
                            <td>85.9</td><td>25.5</td><td>51.1</td><td>52.7</td>
                            <td>48.3</td>
                        </tr>
                        <tr>
                            <td>o1</td>
                            <td>70.8</td><td>25.2</td><td>53.0</td><td>49.6</td>
                            <td>54.6</td><td>39.4</td><td>46.4</td><td>46.8</td>
                            <td>66.4</td><td>20.1</td><td>41.7</td><td>42.0</td>
                            <td>46.7</td>
                        </tr>
                        <tr>
                            <td>o3</td>
                            <td>88.9</td><td>73.6</td><td>71.7</td><td>78.1</td>
                            <td><b>81.6</b></td><td>62.0</td><td>84.5</td><td>76.0</td>
                            <td>91.6</td><td>59.8</td><td>81.1</td><td>78.8</td>
                            <td>77.5</td>
                        </tr>
                        <tr>
                            <td>o4-mini</td>
                            <td>82.4</td><td>62.1</td><td>69.6</td><td>71.4</td>
                            <td>71.0</td><td>57.9</td><td>76.5</td><td>68.5</td>
                            <td>90.3</td><td>52.9</td><td>76.1</td><td>74.3</td>
                            <td>71.0</td>
                        </tr>
                        <tr>
                            <td>Gemini 2.5 Flash Preview</td>
                            <td>63.6</td><td>45.0</td><td>56.9</td><td>55.2</td>
                            <td>46.0</td><td>38.9</td><td>57.1</td><td>47.3</td>
                            <td>82.8</td><td>34.5</td><td>62.0</td><td>59.8</td>
                            <td>53.4</td>
                        </tr>
                        <tr>
                            <td>Gemini 2.5 Pro Preview</td>
                            <td>88.1</td><td>65.7</td><td>74.9</td><td>76.2</td>
                            <td>77.4</td><td>59.1</td><td>80.0</td><td>72.2</td>
                            <td>94.7</td><td>68.0</td><td>83.8</td><td>82.3</td>
                            <td>76.2</td>
                        </tr>
                        <tr>
                            <td>Claude 3.7 Sonnet</td>
                            <td>89.3</td><td>82.8</td><td>77.3</td><td>83.1</td>
                            <td>75.9</td><td>59.4</td><td>73.7</td><td>69.7</td>
                            <td>91.4</td><td>65.5</td><td>85.5</td><td>82.5</td>
                            <td>77.9</td>
                        </tr>
                        <tr>
                            <td><b>Claude 3.7 Sonnet Thinking</b></td>
                            <td><b>90.5</b></td><td><b>85.6</b></td><td><b>82.4</b></td><td><b>86.2</b></td>
                            <td>80.2</td><td><b>74.4</b></td><td><b>86.4</b></td><td><b>80.3</b></td>
                            <td><b>94.9</b></td><td><b>78.9</b></td><td><b>91.4</b></td><td><b>89.4</b></td>
                            <td><b>84.8</b></td>
                        </tr>
                        <tr class="group-header"><td colspan="14">Open-source LLMs</td></tr>
                        <tr>
                            <td>QwQ-32B</td>
                            <td>54.3</td><td>51.0</td><td>31.4</td><td>45.6</td>
                            <td>43.6</td><td>33.5</td><td>46.0</td><td>41.0</td>
                            <td>79.9</td><td>21.1</td><td>51.4</td><td>50.9</td>
                            <td>45.2</td>
                        </tr>
                        <tr>
                            <td>DeepSeek-R1</td>
                            <td>72.6</td><td>62.7</td><td><b>48.4</b></td><td>61.2</td>
                            <td><b>59.3</b></td><td>43.8</td><td>58.2</td><td>53.7</td>
                            <td><b>83.5</b></td><td>35.4</td><td><b>60.4</b></td><td><b>57.4</b></td>
                            <td>57.4</td>
                        </tr>
                        <tr>
                            <td>Qwen-2.5-7B</td>
                            <td>7.1</td><td>10.0</td><td>1.7</td><td>6.3</td>
                            <td>5.2</td><td>5.8</td><td>8.1</td><td>6.4</td>
                            <td>42.6</td><td>5.8</td><td>10.7</td><td>16.1</td>
                            <td>8.8</td>
                        </tr>
                        <tr class="ours-row">
                            <td>Qwen-2.5-7B - RL <b>(Ours)</b></td>
                            <td><b>84.3</b></td><td><b>71.3</b></td><td>46.0</td><td><b>67.2</b></td>
                            <td>55.7</td><td><b>53.9</b></td><td><b>61.7</b></td><td><b>57.1</b></td>
                            <td>63.4</td><td><b>47.5</b></td><td>57.6</td><td>56.8</td>
                            <td><b>60.8</b></td>
                        </tr>
                    </tbody>
                </table>
                <p style="font-size:13px;color:#666;margin-top:6px;">
                    <span>Click any column header to sort ascending/descending. Bold indicates the best in each group.</span>
                </p>
                <script>
                    // 使分组行不可排序，且点击表头可排序
                    $(document).ready(function() {
                        // 先移除分组行，单独保存
                        var groupRows = [];
                        $('#composition-results-table .group-header').each(function(){
                            groupRows.push({
                                index: $(this).index(),
                                html: $(this)[0].outerHTML
                            });
                            $(this).remove();
                        });

                        // 初始化DataTable
                        var table = $('#composition-results-table').DataTable({
                            paging: false,
                            searching: false,
                            info: false,
                            ordering: true,
                            order: [],
                            autoWidth: false,
                            // Model列不可排序
                            columnDefs: [
                                { orderable: false, targets: 0 }
                            ],
                            language: {
                                emptyTable: "无数据"
                            }
                        });

                        // 重新插入分组行
                        groupRows.forEach(function(gr, idx){
                            // 计算插入位置
                            var rowIdx = gr.index - idx;
                            var node = $(gr.html)[0];
                            table.row(rowIdx).node().parentNode.insertBefore(node, table.row(rowIdx).node());
                        });
                    });
                </script>

                
                <h2 id="analysis">Analysis</h2>
                <h3> Reinforcement Learning vs. Best-of-N Sampling </h3>
                <div style="display: flex; justify-content: space-between;">
                    <img src="img/bon-a.svg" alt="Reinforcement Learning vs. Best-of-N Sampling" style="width: 50%;">
                    <img src="img/bon-b.svg" alt="Reinforcement Learning vs. Best-of-N Sampling" style="width: 50%;">
                </div>
                Best-of-N (BoN) only approaches RL training results when N is extremely large, showing that RL is highly effective and not easily matched by simply sampling more.
                
                <p></p>
                <h3>How SGP Generation Capabilities Evolve during Training</h3>
                <p></p>
                <p>
                    <b>Strategy 1: Decomposition into basic components.</b>
                    <img src="img/strategy-decomposition.drawio.svg" alt="Strategy 1: Decomposition into basic components" style="width: 100%;">
                    <!-- The model first breaks down complex objects into simple SVG elements (like <code>&lt;rect&gt;</code>, <code>&lt;circle&gt;</code>, <code>&lt;line&gt;</code>, <code>&lt;path&gt;</code>), often with a brief comment. As training advances, it uses more granular decomposition, resulting in more accurate and well-placed drawings. The improvement comes from better composition of these fixed primitives, not from using more types. -->
                </p>
                <p>
                    <b>Strategy 2: Contextual optional details.</b>
                    <img src="img/optional-elements.drawio.svg" alt="Strategy 2: Contextual optional details" style="width: 100%;">
                    <!-- The model learns to add relevant, unprompted details—such as sprinkles on a cake or waves at a beach—that enhance scene realism and completeness. These additions make the output more coherent and visually appealing. -->
                </p>

                <h2 id="bibtex">Bibtex</h2>
                <div class="bibtex-block">
                    <pre class="bibtex-pre" id="bibtex-content">@article{chen2025sgp,
  title={Symbolic Graphics Programming with Large Language Models},
  author={Chen, Yamei and Zhang, Haoquan and Huang, Yangyi and Qiu, Zeju and Zhang, Kaipeng and Wen, Yandong and Liu, Weiyang},
  journal={arXiv preprint arXiv:2509.01000},
  year={2025}
}</pre>
                    <button class="bibtex-copy-btn" onclick="navigator.clipboard.writeText(document.getElementById('bibtex-content').innerText)">Copy</button>
                </div>
            </div>
        </article>
    </main>

    <footer>
        <div class="container">
            <div class="copyright">
                <p>&copy; 2025 SphereLab. All rights reserved.</p>
                <p>Webpage designed by <a href="https://haoquanzhang.github.io" style="text-decoration: underline;">Haoquan Zhang</a>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize section highlighting
            initSectionHighlight();
            // Load case data and create buttons
            loadCaseButtons();
        });
        
        function initSectionHighlight() {
            const sectionLinks = document.querySelectorAll('.section-nav .section-link');
            const sections = document.querySelectorAll('h1[id], h2[id], .feature-buttons[id]');
            
            // Highlight the current section on scroll
            function highlightSection() {
                const scrollPosition = window.scrollY + 100;
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;
                    const sectionId = section.getAttribute('id');
                    
                    if (sectionId && 
                        scrollPosition >= sectionTop && 
                        scrollPosition < sectionTop + sectionHeight) {
                        
                        sectionLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${sectionId}`) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }
            
            window.addEventListener('scroll', highlightSection);
            highlightSection(); // Run once on initial load
            
            // Smooth scrolling for section links
            sectionLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                        
                        // Update active state
                        sectionLinks.forEach(link => link.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });
        }
        
        async function loadCaseButtons() {
            try {
                // Load the case metadata
                const casesResponse = await fetch('assets/trajectory_cases.json');
                
                if (!casesResponse.ok) {
                    throw new Error(`Failed to load cases data: ${casesResponse.status}`);
                }
                
                const casesData = await casesResponse.json();
                
                // Get the category sections container
                const categorySectionsContainer = document.getElementById('category-sections');
                categorySectionsContainer.innerHTML = '';
                
                // Create sections for each category
                const categories = Object.keys(casesData);
                
                categories.forEach((categoryName, categoryIndex) => {
                    const categorySection = document.createElement('div');
                    categorySection.className = 'category-section';
                    categorySection.innerHTML = `
                        <h3 id="${categoryName.toLowerCase()}" class="category-title">${categoryName}</h3>
                        <div class="feature-buttons category-buttons" id="buttons-${categoryName}"></div>
                        <div class="reasoning-process">
                            <div id="reasoning-container-${categoryName}" class="reasoning-container">
                                <div class="reasoning-loading">
                                    <div class="loading-spinner"></div>
                                    <p>Select a case to view the reasoning process...</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    categorySectionsContainer.appendChild(categorySection);
                    
                    // Create buttons for this category
                    const buttonsContainer = document.getElementById(`buttons-${categoryName}`);
                    const cases = casesData[categoryName];
                    
                    cases.forEach((caseInfo, caseIndex) => {
                        const button = document.createElement('button');
                        button.className = 'feature-button' + (caseIndex === 0 ? ' active' : '');
                        button.setAttribute('data-file-dir', caseInfo.file_dir);
                        button.setAttribute('data-category', categoryName);
                        button.textContent = caseInfo.show_name;
                        
                        button.addEventListener('click', function() {
                            // Remove active class from all buttons in this category
                            buttonsContainer.querySelectorAll('.feature-button').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            // Add active class to clicked button
                            this.classList.add('active');
                            // Load the trajectory case
                            loadTrajectoryCase(this.getAttribute('data-file-dir'), this.getAttribute('data-category'));
                        });
                        
                        buttonsContainer.appendChild(button);
                    });
                    
                    // 自动加载第一个案例
                    if (cases.length > 0) {
                        loadTrajectoryCase(cases[0].file_dir, categoryName);
                    }
                });
                
            } catch (error) {
                console.error('Error loading case buttons:', error);
                const categorySectionsContainer = document.getElementById('category-sections');
                categorySectionsContainer.innerHTML = '<p>Error loading examples. Please try again later.</p>';
            }
        }
        
        async function loadTrajectoryCase(fileDir, category) {
            const container = document.getElementById(`reasoning-container-${category}`);
            container.innerHTML = `
                <div class="reasoning-loading">
                    <div class="loading-spinner"></div>
                <p>Loading visual reasoning process...</p>
                </div>
            `;
            try {
                // Load conversation from the specified directory
                const response = await fetch(`${fileDir}/conversations.json`);
                if (!response.ok) {
                    throw new Error(`Failed to load conversations: ${response.status}`);
                }
                const conversation = await response.json();
                renderConversation(conversation, container, fileDir);
            } catch (error) {
                console.error('Error loading conversation:', error);
                container.innerHTML = `
                    <div class="reasoning-error">
                        <div class="error-icon">⚠️</div>
                        <p>Error loading the reasoning process: ${error.message}</p>
                        <p>Please check the browser console for more details.</p>
                    </div>
                `;
            }
        }

        function renderConversation(conversation, container, fileDir) {
            container.innerHTML = '';
            conversation.forEach((msg, idx) => {
                const msgDiv = document.createElement('div');
                msgDiv.className = `reasoning-message reasoning-${msg.from}`;
                let value = msg.value;

                // 1. 先提取所有代码块，临时用占位符替换（统一用[[CODEBLOCK0]]格式）
                const codeBlocks = [];
                value = value.replace(/<code>\n```python\n([\s\S]*?)\n```\n<\/code>/g, (match, code) => {
                    codeBlocks.push(code);
                    return `[[CODEBLOCK${codeBlocks.length - 1}]]`;
                });

                // 2. 提取图片为占位符
                const imageBlocks = [];
                value = value.replace(/<image_clue_(\d+)>.*?<\/image_clue_\d+>/gs, (match, p1) => {
                    imageBlocks.push(p1);
                    return `[[IMAGEBLOCK${imageBlocks.length - 1}]]`;
                });

                // 3. 渲染interpreter输出 <interpreter>...</interpreter>
                value = value.replace(/<interpreter>([\s\S]*?)<\/interpreter>/g, (match, output) => {
                    if (output.includes('reasoning-image-wrap')) {
                        return `<div class="tag-indicator">&lt;interpreter&gt;</div><div class="reasoning-interpreter-output">${output}</div><div class="tag-indicator">&lt;/interpreter&gt;</div>`;
                    } else {
                        return `<div class="tag-indicator">&lt;interpreter&gt;</div><div class="reasoning-interpreter-output">${escapeHtml(output)}</div><div class="tag-indicator">&lt;/interpreter&gt;</div>`;
                    }
                });

                // 4. 渲染最终答案 <answer>...</answer>
                value = value.replace(/<answer>\n\\boxed{([\s\S]*?)}\n<\/answer>/g, (match, answer) => {
                    return `<div class="tag-indicator">&lt;answer&gt;</div><div class="reasoning-answer"><div class="answer-box">Final Answer: \\boxed{${escapeHtml(answer)}}</div></div><div class="tag-indicator">&lt;/answer&gt;</div>`;
                });

                // 5. 只对普通文本做换行和markdown处理
                value = value.replace(/\n/g, '<br>');
                value = value.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
                value = value.replace(/\*([^*]+)\*/g, '<em>$1</em>');
                value = value.replace(/__([^_]+)__/g, '<strong>$1</strong>');
                value = value.replace(/_([^_]+)_/g, '<em>$1</em>');

                // 6. 还原图片
                value = value.replace(/\[\[IMAGEBLOCK(\d+)\]\]/g, (match, idx) => {
                    const img = document.createElement('img');
                    img.src = `${fileDir}/images/image_${imageBlocks[idx]}.png`;
                    img.className = 'reasoning-image';
                    img.alt = `image_${imageBlocks[idx]}`;
                    img.onerror = function() {
                        this.onerror = null;
                        this.src = 'https://via.placeholder.com/600x400?text=Image+Load+Failed';
                    };
                    const wrap = document.createElement('div');
                    wrap.className = 'reasoning-image-wrap';
                    wrap.appendChild(img);
                    // 添加标识符并返回HTML字符串
                    return `<div class="tag-indicator">&lt;image_clue_${imageBlocks[idx]}&gt;</div>${wrap.outerHTML}<div class="tag-indicator">&lt;/image_clue_${imageBlocks[idx]}&gt;</div>`;
                });

                // 7. 还原代码块
                value = value.replace(/\[\[CODEBLOCK(\d+)\]\]/g, (match, idx) => {
                    return `<div class="tag-indicator">&lt;code&gt;</div><div class="reasoning-code"><pre><code class="language-python">${escapeHtml(codeBlocks[idx])}</code></pre></div><div class="tag-indicator">&lt;/code&gt;</div>`;
                });

                // 对话气泡样式
                const bubbleClass = msg.from === 'human' ? 'bubble-human' : 'bubble-gpt';
                msgDiv.innerHTML = `<div class="bubble ${bubbleClass}">${value}</div>`;
                container.appendChild(msgDiv);
            });
            // 代码高亮
            if (window.hljs) {
                container.querySelectorAll('pre code').forEach((block) => {
                    window.hljs.highlightBlock(block);
                });
            }
        }

        // HTML转义
        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;')
                      .replace(/"/g, '&quot;')
                      .replace(/'/g, '&#39;');
        }
    </script>
    
    <!-- Add highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</body>
</html> 
